#include "common.h"

f_rsmap main(v2p_rsmap I)
{
	f_rsmap O;

	float4 C = s_base.Sample(smp_base, I.tc0);

#ifndef USE_VSM
	float flux = 1;

	O.P = float4(I.P.xyz, xmaterial); // P.mtl
	O.N = float4(I.N.xyz, flux);
	O.C = C;
#else
	float depth = I.hpos.z;
	O.D.x = depth;
	O.D.y = depth * depth;
#endif

#ifdef USE_AREF
	clip(C.w - def_aref);
#endif

	return O;
}